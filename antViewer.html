<!DOCTYPE html>
<html>
  <head>
    <title>AFS Ant Viewer</title>
    <meta name="author" content="D.A. Braksator">
    <meta name="year" content="2023">
    <link rel="stylesheet" type="text/css" href="./src/afs.css">
    <style type="text/css">
      body#ant-viewer {
        height: 100%;
        margin: 2em 1em;
        padding: 0;
        background: rgba(26, 142, 207,.75);
        font-family: Optima, Candara, 'Noto Sans', source-sans-pro, sans-serif;
        user-select: none
      }
      #ant { display: none; }
      #classForm a {
        display: inline;
      }
      .view-ant .ant {
        /*background: rgba(255,255,136,0.5);*/
        position: absolute;
        left: 50%;
        top: 50%;
        display: block;
      }
      .view-ant p {
        font-size: small;
        text-align: center;

        margin-bottom: 1em;
        color: #eee;
        position: absolute;
        left: 50%;
        top: 0.5em;
        transform: translateX(-50%);
      }
      h3 {
        margin: 1em;
        color: #eee;
      }
      .view-ant {
        margin: 0 0 1em 1em;
        padding-top: 30px;
        border: .5px solid #eee;
        border-radius: 5px;
        display: inline-block;
        position: relative;
        width: 64px;
        height: 94px;
      }
      .full {
        width: 320px;
        height: 320px;
      }
      .full .ant {
        transform: translate(-50%,-50%) scale(5) rotate(90deg);
      }
      fieldset {
        display: inline-block;
      }
    </style>
  </head>
  <body id="ant-viewer">

    <!-- Ant template -->
    <div id="ant" class="ant">
      <div class="spot"></div>
      <div class="body">
        <div class="body-mag">
          <div class="body-wrap">
            <div class="legs legs-l">
              <div class="leg"><div class="foot"></div></div>
              <div class="leg"><div class="foot"></div></div>
              <div class="leg"><div class="foot"></div></div>
            </div>
            <div class="head">
              <div class="antenna"></div>
              <div class="antenna"></div>
              <div class="hat"></div>
              <div class="c"></div>
            </div>
            <div class="torso"></div>
            <div class="rear"></div>
            <div class="legs legs-r">
              <div class="leg"><div class="foot"></div></div>
              <div class="leg"><div class="foot"></div></div>
              <div class="leg"><div class="foot"></div></div>
            </div>
            <div class="wings">
              <div class="wing wing-l"></div>
              <div class="wing wing-r"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

<script>
const types = {
  N: {
    n: 'Black',
    v: 1, // speed
    s: 'm', // size
    d: 2, // 2 = meat/protein preference.
  },
  T: {
    n: 'Tiny',
    v: .8, // speed
    s: 's', // size
    d: 1, // 1 = sugar/carb/sweet eater.
  },
  B: {
    n: 'Bull',
    v: 1.2, // speed
    b: 1, // This ant bites.
    s: 'l', // size
    d: 2, // 2 = meat/protein preference.
    m: 50, // maxmood
  },
  G: {
    n: 'Green',
    v: 1.1, // speed
    b: 1, // This ant bites.
    s: 'm', // size
    d: 1, // 1 = sugar/carb/sweet eater.
    m: 75, // maxmood
  },
  F: {
    n: 'Fire',
    v: .9, // speed
    b: 1, // This ant bites.
    s: 's', // size
    d: 2, // 2 = meat/protein preference.
    m: 75, // maxmood
  },
  C: {
    n: 'Crazy',
    v: 1.5, // Note: Code assumes this is max speed.
    s: 'l', // size
    d: 1, // 1 = sugar/carb/sweet eater.
    m: 50, // maxmood
  },
  J: {
    n: 'Ghost',
    v: .7, // speed
    s: 's', // size
    d: 2, // 2 = meat/protein preference.
    p: 1 // pro-level
  },
  P: {
    n: 'Pharaoh',
    v: .7, // speed
    b: 1, // This ant bites.
    s: 'm', // size
    d: 2, // 2 = meat/protein preference.
    p: 1 // pro-level
  },
  M: {
    n: 'Chimera',
    v: .6, // speed
    s: 's', // size
    d: 0, // 0 - no food preference
    p: 1 // pro-level
  },
  Z: {
    n: 'Sugar',
    v: .6, // speed
    s: 'm', // size
    d: 1, // 1 = sugar/carb/sweet eater.
    p: 1 // pro-level
  },
  K: {
    n: 'Carpenter',
    v: .6, // speed
    s: 'm', // size
    d: 1, // 1 = sugar/carb/sweet eater.
    p: 1 // pro-level
  },
  H: {
    n: 'Red Harvester',
    v: .6, // speed
    s: 'm', // size
    d: 1, // 1 = sugar/carb/sweet eater.
    p: 1 // pro-level
  },
};

// Draw an ant.
function drawAnt(ant, container = document.body) {
  // Create a copy of the HTML template for the ant
  const antTemplate = document.querySelector('#ant');
  const newAnt = antTemplate.cloneNode(true);
  newAnt.id = ant.id; // Remove the ID to avoid duplicate IDs
  newAnt.classList.add(ant.type);
  if (types[ant.type]) {
    newAnt.classList.add(types[ant.type].s);
  }
  newAnt.dataset.id = ant.id;
  // Add the ant to the document
  container.appendChild(newAnt);
  newAnt.style.display = 'block';
}

function viewAnts() {
  const viewSizes = ['full', ''];
  const antSizes = ['b', 's', 'm', 'l', 'x'];

  for (var viewSize of viewSizes) {

    var h = document.createElement('h3');
    h.textContent = viewSize ? 'Full view' : 'Ant sizes';
    document.body.appendChild(h);

    for (var antSize of antSizes) {
      const ant = {
        id: antSize + (viewSize ? '-' + viewSize : ''),
        type: antSize,
        name: antSize + (viewSize ? '-' + viewSize : '')
      };
      var divElement = document.createElement('div');
      divElement.className = 'view-ant ' + viewSize;
      // Create the paragraph element and set its text content
      var paragraphElement = document.createElement('p');
      paragraphElement.textContent = antSize + (viewSize ? ' ' + viewSize : '');
      // Append the paragraph element to the div
      divElement.appendChild(paragraphElement);
      drawAnt(ant, divElement);
      document.body.appendChild(divElement);
    }
  }

  let typeNames = Object.keys(types);
  var h = document.createElement('h3');
  h.textContent = 'Types';
  document.body.appendChild(h);
  for (var type of typeNames) {
    let ant = {
      id: type,
      type: type,
      name: type
    };
    var divElement = document.createElement('div');
    divElement.className = 'view-ant';
    // Create the paragraph element and set its text content
    var paragraphElement = document.createElement('p');
    paragraphElement.textContent = type;
    // Append the paragraph element to the div
    divElement.appendChild(paragraphElement);
    drawAnt(ant, divElement);
    document.body.appendChild(divElement);
  }

  let typeRadios = document.getElementById('typeRadios');
  Object.keys(types).forEach(t => {
    typeRadios.insertAdjacentHTML('beforeend',
      `<label><input type="radio" name="type" value="${t}">${t}</label> `);
  });

  // Categories to join: pose, action, type, caste
  let form = document.getElementById('classForm');
  let radios = form.querySelectorAll('input[type=radio],input[type=checkbox]');
  let carrySelect = form.querySelectorAll('select[name=carry]')[0];
  let classNameInput = document.getElementById('classNameInput');

  form.addEventListener('change', () => {
    let values = {};
    radios.forEach(r => {
      if (r.checked && r.value) values[r.name] = r.value;
    });
    // Build a class string from chosen parts
    let classParam = Object.values(values).join(' ');
    let url = '?class=' + encodeURIComponent(classParam);
    let carryValue = carrySelect.options[carrySelect.selectedIndex]?.value;
    if (carryValue) url += '&carry=' + encodeURIComponent(carryValue);
    history.replaceState(null, '', url); // updates address bar without reload
  });

  form.addEventListener('submit', e => {
    e.preventDefault();
    // On submit go to the URL with class parameter
    let values = {};
    radios.forEach(r => {
      if (r.checked && r.value) values[r.name] = r.value;
    });
    var enteredClassName = classNameInput.value.trim();
    let classParam = Object.values(values).join(' ');
    if (enteredClassName) classParam += ' ' + enteredClassName;
    let carryValue = carrySelect.options[carrySelect.selectedIndex]?.value;
    window.location.href = '?class=' + encodeURIComponent(classParam) + (carryValue ? '&carry=' + encodeURIComponent(carryValue) : '');
  });

  // On page load: prefill radios from ?class
  let urlParams = new URLSearchParams(window.location.search);
  let classParam = urlParams.get('class');
  if (classParam) {
    let parts = classParam.split(' ');
    let usedClasses = [];
    radios.forEach(r => {
      if (parts.includes(r.value)) r.checked = true;
      usedClasses.push(r.value);
    });
    parts.forEach(p => !usedClasses.includes(p) && (classNameInput.value += p + ' '));
  }

  let carryParam = urlParams.get('carry');
  carrySelect.value = carryParam;

  document.querySelectorAll('.ant .c').forEach(cEl => {
    let carryMap = {
      egg: `<div class="egg"></div>`,
      saltpork: `<div class="carry Cfood saltpork"></div>`,
      hotdog: `<div class="carry Cfood hotdog"></div>`,
      bread: `<div class="carry Cfood bread"></div>`,
      danish: `<div class="carry Cfood danish"></div>`,
      asti: `<div class="carry Cdrink asti"></div>`,
      cola: `<div class="carry Cdrink cola"></div>`,
      flesh: `<div class="carry Cfood flesh"></div>`,
    };
    cEl.innerHTML = carryParam ? carryMap[carryParam] : '';
  });


  // Add additional class(es) to all elements with class "ant"
  function addAdditionalClassToAnts() {
    var additionalClassName = urlParams.get('class');
    if (additionalClassName) {
      var ants = document.querySelectorAll('.full .ant');
      for (var i = 0; i < ants.length; i++) {
        ants[i].classList.add.apply(ants[i].classList, additionalClassName.split(' '));
      }
    }
  }
  // Call the function to add additional class(es) to ants
  addAdditionalClassToAnts();
}


window.addEventListener('load', viewAnts);


</script>
    <form id="classForm">
      <fieldset>
        <legend>Pose</legend>
        <label><input type="radio" name="pose" value=""><em>(clear)</em></label>
        <label><input type="radio" name="pose" value="prone">prone</label>
        <label><input type="radio" name="pose" value="side">side</label>
        <label><input type="radio" name="pose" value="pick">pick</label>
      </fieldset>

      <fieldset>
        <legend>Action</legend>
        <label><input type="checkbox" name="walk" value="walk">walk</label>
        <label><input type="checkbox" name="jit" value="jit">jit</label>
        <label><input type="checkbox" name="dig" value="dig">dig</label>
        <label><input type="checkbox" name="wig" value="wig">wig</label>
      </fieldset>

      <fieldset>
        <legend>Type</legend>
        <label><input type="radio" name="type" value=""><em>(clear)</em></label>
        <span id="typeRadios"></span>
      </fieldset>

      <fieldset>
        <legend>Caste</legend>
        <label><input type="radio" name="caste" value=""><em>(clear)</em></label>
        <label><input type="radio" name="caste" value="W">W</label>
        <label><input type="radio" name="caste" value="Q">Q</label>
        <label><input type="radio" name="caste" value="D">D</label>
      </fieldset>


      <fieldset>
        <legend>State</legend>
        <label><input type="radio" name="state" value=""><em>(clear)</em></label>
        <label><input type="radio" name="state" value="free">free</label>
        <label><input type="radio" name="state" value="cap">cap</label>
        <label><input type="radio" name="state" value="tube">tube</label>
        <label><input type="radio" name="state" value="vial">vial</label>
        <label><input type="radio" name="state" value="dead">dead</label>
      </fieldset>

      <fieldset>
        <legend>Misc</legend>
        <label><input type="checkbox" name="fall" value="fall">fall</label>
        <label><input type="checkbox" name="fight" value="fight">fight</label>
        <label><input type="checkbox" name="h" value="h">h</label>
        <label><input type="checkbox" name="mag" value="mag">mag</label>
        <label><input type="checkbox" name="alate" value="alate">alate</label>
        <label><input type="checkbox" name="flare" value="flare">flare</label>
      </fieldset>

      <fieldset>
        <legend>Infant</legend>
        <label><input type="radio" name="inf" value=""><em>(clear)</em></label>
        <label><input type="radio" name="inf" value="inf1">inf1</label>
        <label><input type="radio" name="inf" value="inf2">inf2</label>
        <label><input type="radio" name="inf" value="inf3">inf3</label>
        <label><input type="radio" name="inf" value="inf4">inf4</label>
      </fieldset>

      <fieldset>
        <legend>Infant anim</legend>
        <label><input type="checkbox" name="a1" value="a1">a1</label>
        <label><input type="checkbox" name="a2" value="a2">a2</label>
        <label><input type="checkbox" name="a3" value="a3">a3</label>
      </fieldset>

      <fieldset>
        <legend>Remove parts</legend>
        <label><input type="checkbox" name="rmlegs" value="rmlegs">rmlegs</label>
        <label><input type="checkbox" name="rmhead" value="rmhead">rmhead</label>
        <label><input type="checkbox" name="rmrear" value="rmrear">rmrear</label>
      </fieldset>

      <fieldset>
        <legend>Carry</legend>
        <select name="carry">
          <option value="">(clear)</option>
          <option value="egg">Egg</option>
          <option value="saltpork">Salt Pork!</option>
          <option value="hotdog">Hot Dog</option>
          <option value="bread">Bread</option>
          <option value="danish">Danish</option>
          <option value="asti">Asti</option>
          <option value="cola">Cola</option>
          <option value="flesh">Flesh</option>
        </select>
      </fieldset>

      <input type="text" id="classNameInput" width="40" placeholder="Add Classes">

      <button type="submit">Go</button>
    </form>
    <p style="font-size:.8em;color:#333;margin-top:.5em;">(Only certain combinations have been styled)</p>

  </body>
</html>